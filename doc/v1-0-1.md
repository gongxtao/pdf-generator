## **v1.0.1 需要完成的需求**

## 优化/editorview页面
1. 优化editorview页面，生成PDF完成后，在右侧PDF预览区域，不仅能看到PDF的内容，还能实时编辑PDF的内容；
2. 生成PDF过程中，由于生成PDF的过程比较耗时，所以需要在生成PDF的过程中，显示loading动画，提示用户当前正在生成PDF；

# EditorView 页面优化需求文档

## 概述
### 背景
EditorView 页面是前端应用的编辑核心，用于处理用户输入的杂乱文本/图片内容，通过 AI + CSS 模板生成结构化的 PDF 输出。现有流程：左侧源编辑器输入内容 → 生成 PDF → 右侧静态预览。但用户反馈显示，直接编辑 PDF 不够直观，用户希望类似 Microsoft Word 的编辑体验，便于实时修改内容（如文本格式、图片调整），同时保持生成 PDF 的核心技术路线（CSS + 文本 → HTML → PDF）不变。

### 目标
- **核心目标**：提供无缝、用户友好的实时编辑体验，允许用户在生成后的“美化”内容上进行微调，而不影响左侧源内容。
- **业务价值**：提升用户满意度（减少学习曲线），提高编辑效率（Word 式界面），确保 PDF 输出质量（保留 AI/CSS 规范）。
- **范围**：仅优化 EditorView 页面，不涉及新页面或后端变更。生成 PDF 流程保持不变。
- **假设**：技术栈为 React（可调整）；无后端依赖，纯前端实现。

### 目标用户
- **主要用户**：内容创作者、设计师（非专业开发者），使用该工具整理杂乱笔记/图片为专业 PDF。
- **用户痛点**：PDF 编辑生涩；希望熟悉的 Word-like 界面；源内容需隔离保护。
- **用户场景**：用户输入杂乱文本 → AI 生成 HTML/CSS → 编辑润色 → 导出 PDF 分享。

## 功能规格
### 核心功能
1. **源内容隔离显示**：
   - 左侧显示原始用户输入（杂乱文本/图片描述），完全只读。
   - 无任何交互（禁用点击、输入），视觉提示“源内容不可修改”。

2. **类 Word 实时编辑器**：
   - 右侧加载富文本编辑器（WYSIWYG），初始化为 AI/CSS 生成的 HTML 内容。
   - 支持编辑操作：
     - 文本：插入/修改文字、字体（大小、粗体、斜体、颜色）、对齐（左/中/右）、列表（有序/无序）。
     - 图片：拖拽插入/替换（上传新图，自动适配 CSS 模板，如尺寸、圆角、阴影）。
     - 布局：调整段落间距、表格（简单行列编辑）、页眉/页脚（可选）。
   - 实时预览：编辑变更即时反映（<100ms 延迟），应用 CSS 模板样式（e.g., Flexbox/Grid 布局）。

3. **一键 PDF 导出**：
   - 点击“导出 PDF”按钮，将编辑器 HTML + CSS 通过 html2pdf.js（或类似）转为 PDF。
   - 保持原有生成路线：HTML 渲染 → Canvas 捕获 → PDF 转换。
   - 导出选项：生成新文件（e.g., `edited_v2.pdf`），支持覆盖或下载。

4. **编辑历史管理**：
   - 内置撤销/重做（10 步栈），支持 Ctrl+Z/Y。

### UI/UX 设计
- **页面布局**：
  - 整体：Flexbox 左右分栏（左侧 40%、右侧 60%），全屏高度。
  - 左侧：灰色背景（opacity: 0.5），标题“源内容（不可修改）”，内容以 <pre> 或简单列表显示。
  - 右侧：
    - 顶部工具栏：字体下拉、格式按钮（粗体/斜体/颜色）、图片上传、撤销/重做、导出 PDF。
    - 主体：编辑器容器（高度 600px+，滚动支持），嵌入 Quill/Tiptap。
    - 底部：状态提示（e.g., “已编辑 3 处”）。
- **交互细节**：
  - 工具栏：浮动/固定，响应式（移动端折叠为图标菜单）。
  - 反馈：编辑时高亮变更（绿色动画），导出中显示 Spinner（“生成 PDF...”）。
  - 引导：首次加载，Tooltip：“双击文本编辑，拖拽图片调整，左侧源不变。”
- **响应式设计**：
  - 桌面：分栏布局。
  - 移动端：编辑器全屏，工具栏底部浮动，触屏优化（长按选区、捏合缩放图片）。
- **视觉风格**：现代简洁（Arial 字体，#f5f5f5 背景），一致于应用主题。

### 输入/输出格式
- **输入**：
  - 源内容：字符串（文本 + 图片 URL 描述），e.g., "杂乱文本: Hello 世界! 图片: logo.png"。
  - AI/CSS 生成：HTML 片段 + 嵌入 CSS，e.g., `<div class="template"><h1>Hello</h1><img src="..."/></div>`。
- **输出**：
  - 编辑后 HTML：富文本 Delta 或 HTML 字符串。
  - PDF：Blob（application/pdf，A4 格式，<10MB），下载链接。
- **数据流**：源 → AI/CSS → HTML 初始化编辑器 → 用户编辑 → HTML → PDF。

### 边缘场景 & 约束
- **边缘场景**：
  - 复杂内容：多页 HTML 用分页标记（<div class="page-break">），编辑器默认单页；表格限 5x5 网格。
  - 空内容：生成空 HTML，提示“请添加内容”。
  - 并发编辑：单用户场景，无需锁；多标签页刷新重置编辑。
- **约束**：
  - 图片上传：限 5MB/JPG/PNG，自动压缩。
  - 内容大小：单页 <1MB HTML，超过提示简化。
  - 错误处理：编辑崩溃回滚，导出失败 toast（“重试或检查格式”）。

## 非功能需求
- **性能**：
  - 编辑延迟：<100ms（防抖优化）。
  - PDF 导出：<5s（单页），进度条显示。
  - 内存：<300MB，懒加载图片。
- **安全性**：
  - HTML 过滤：用 DOMPurify 防 XSS。
  - 上传验证：客户端尺寸/类型检查，无服务器存储。
- **兼容性**：
  - 浏览器：Chrome/Edge/Firefox (2025 版)，Safari iOS 15+。
  - 设备：桌面/移动（响应式）。
- **可访问性**：
  - ARIA 标签（工具栏按钮）、键盘导航（Tab 焦点编辑器）。
- **国际化**：
  - 中文优先，支持英文（i18n 工具栏文本）。

## 实施建议
### 技术栈
- **前端框架**：React 18+。
- **编辑器**：Quill.js v2.x（轻量，Word-like 工具栏）或 Tiptap（ProseMirror 基，更现代）。
- **PDF 导出**：html2pdf.js v0.10（HTML → PDF，保持 CSS 路线）。
- **状态管理**：React useState（简单）或 Zustand（隔离源/编辑状态）。
- **依赖**：
  - npm: quill, html2pdf.js, dompurify。
  - CDN: Quill 主题 CSS。
- **集成示例**：见附录代码片段。

### 时间估算 & 优先级
| 子任务 | 优先级 | 估算时间（人天） | 依赖 |
|--------|--------|------------------|------|
| Quill 编辑器集成 & HTML 加载 | 高 | 1 | - |
| 工具栏 & 编辑操作实现 | 高 | 1 | 编辑器 |
| PDF 导出 & 验证 | 中 | 0.5 | 编辑操作 |
| 隔离机制 & UI 响应式 | 高 | 0.5 | 全 |
| 测试（单元/E2E） | 中 | 1 | 全 |
| **总计** | - | **4** | - |

### 测试计划
- **单元测试**：编辑变更不影响源（Jest + React Testing Library）。
- **E2E 测试**：Cypress 模拟用户流（编辑 → 导出 → 验证 PDF）。
- **性能测试**：Lighthouse 审计（加载 <3s，编辑流畅）。
- **验收标准**：用户能编辑文本/图片，导出 PDF 保留样式，源不变。

### 风险 & 缓解
- **风险**：HTML → PDF 样式偏差（5% 像素偏移）。
  - 缓解：调试 CSS media print，测试多浏览器。
- **风险**：编辑器库兼容性。
  - 缓解：用 Quill（稳定），备选 Tiptap。

## 附录
### 示例代码（React + Quill）
见之前讨论的 EditorView.jsx（完整实现，包含隔离与导出）。

### 澄清问题（待用户回答）
1. 编辑器具体功能：需表格/页眉支持吗？Quill 够用，还是 Tiptap？
2. 导出：覆盖原 PDF 还是始终新文件？需预览导出结果？
3. 技术栈：React 确认？AI 生成 HTML 示例？
4. 性能：预期内容大小（页数/元素）？

### 参考资源
- Quill 文档：https://quilljs.com/docs/quickstart/
- html2pdf.js 示例：https://ekoopmans.github.io/html2pdf.js/

此文档基于需求讨论生成，如需调整，请提供反馈！