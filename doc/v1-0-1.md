## v1.0.1 需要完成的需求

## 优化/editorview页面
1. 优化editorview页面，生成PDF完成后，在右侧PDF预览区域，不仅能看到PDF的内容，还能实时编辑PDF的内容；
2. 生成PDF过程中，由于生成PDF的过程比较耗时，所以需要在生成PDF的过程中，显示loading动画，提示用户当前正在生成PDF；

## 概述
### 背景
EditorView 页面是前端应用的编辑核心，用于处理用户输入的杂乱文本/图片内容，通过 AI + CSS 模板生成结构化的 PDF 输出。现有流程：左侧源编辑器输入内容 → 生成 PDF → 右侧静态预览。但用户反馈显示，用户希望右侧静态预览PDF区域可以有类似 Microsoft Word 的编辑体验，便于实时修改内容（如文本格式、图片调整），编辑完成后，可以直接，同时保持生成 PDF 的核心技术路线（CSS + 文本 → HTML → PDF）不变。

### 目标
- **核心目标**：提供无缝、用户友好的实时编辑体验，允许用户在生成后的“美化”内容上进行微调，而不影响左侧源内容。
- **业务价值**：提升用户满意度（减少学习曲线），提高编辑效率（Word 式界面），确保 PDF 输出质量（保留 AI/CSS 规范）。
- **范围**：仅优化 EditorView 页面，不涉及新页面或后端变更。生成 PDF 流程保持不变。

### 目标用户
- **主要用户**：内容创作者、设计师（非专业开发者），使用该工具整理杂乱笔记/图片为专业 PDF。
- **用户痛点**：PDF 编辑复杂；希望熟悉的 Word-like 界面。
- **用户场景**：用户上传的文档内容（包括文本、图片和表格等）或输出的文本 → AI 生成 HTML/CSS → 编辑润色 → 导出 PDF 分享。

## 功能规格
### 核心功能
1. **源内容隔离显示**：
   - 左侧功能区域支持用户上传的文档内容（包括不限于文本、图片和表格等），当用户上传的文档中包括图片时，系统解析完文档后，在回显到文本框里时，将该图片显示的地方使用占位符来表示；
   - 若用户不想上传文档，用户可以直接在文本框里输入文本、表格描述等。
   - 输入完成后，用户可以点击“生成PDF”按钮，系统会根据用户输入的内容，生成PDF文件；
   - 此时，生成的PDF文件内容支持在类Word的编辑区域进行编辑。

2. **类 Word 实时编辑器（Tiptap 开源版）**：
   - 右侧加载Tiptap 编辑器，初始化为 AI/CSS 生成的 HTML 内容。
   - 支持编辑操作：
     - 文本：插入/修改文字、字体（大小、粗体、斜体、颜色）、对齐（左/中/右）、列表（有序/无序）。
     - 图片：拖拽插入/替换（上传新图，自动适配 CSS 模板，如尺寸、圆角、阴影）。
     - 布局：调整段落间距、表格（简单行列编辑）、页眉/页脚（可选）。
   - 实时预览：编辑变更即时反映（<100ms 延迟），应用 CSS 模板样式（e.g., Flexbox/Grid 布局）。

3. **一键 PDF 导出**：
   - 点击“导出 PDF”按钮，前端 POST 编辑器 HTML（或初始 HTML）到后端 /api/export-pdf。
   - 后端使用 Puppeteer 启动 headless Chrome，渲染 HTML（完整 CSS/JS 支持），生成 A4 PDF。
   - 前端接收 PDF Blob，提供下载（edited.pdf），支持覆盖或新文件。
   - 导出选项：页眉/页脚（可选），边距 10mm，字体嵌入（Arial/Noto）。

4. **编辑历史管理**：
   - 内置撤销/重做（10 步栈），支持 Ctrl+Z/Y。

### UI/UX 设计
- **页面布局**：
  - 整体：整体布局保持不变化，只需要修改PDF预览区域即可。
  - 左侧：保持不变化，只需要修改PDF预览区域即可。
  - 右侧：将PDF预览区域进行修改。
    - 顶部工具栏：字体下拉、格式按钮（粗体/斜体/颜色）、图片上传、撤销/重做、导出 PDF。
    - 主体：Tiptap 编辑器容器（将PDF预览区域替换为Tiptap编辑器），嵌入 WYSIWYG 内容。
    - 底部：状态提示（e.g., “已编辑 3 处”）。
- **交互细节**：
  - 工具栏：浮动/固定，响应式（移动端折叠为图标菜单）。
  - 反馈：编辑时高亮变更（绿色动画），导出中显示 Spinner（“生成 PDF...”）。
  - 引导：首次加载，Tooltip：“双击文本编辑，拖拽图片调整，左侧源不变。”
- **响应式设计**：
  - 桌面：分栏布局。
  - 移动端：编辑器全屏，工具栏底部浮动，触屏优化（长按选区、捏合缩放图片）。
- **视觉风格**：现代简洁（Arial/Noto 字体，#f5f5f5 背景），一致于应用主题。

### 输入/输出格式
- **输入**：
  - 源内容：字符串（文本 + 图片 URL 描述），e.g., "杂乱文本: Hello 世界! 图片: logo.png"。
  - AI/CSS 生成：HTML 片段 + 嵌入 CSS，e.g., `<div class="template"><h1>Hello</h1><img src="..."/></div>`。
- **输出**：
  - 编辑后 HTML：Tiptap JSON 或 HTML 字符串（editor.getHTML()）。
  - PDF：Blob（application/pdf，A4 格式，<10MB），下载链接。
- **数据流**：源 → AI/CSS → HTML 初始化编辑器 → 用户编辑 → HTML → PDF。

### 边缘场景 & 约束
- **边缘场景**：
  - 复杂内容：嵌套 Grid/动态 JS 支持（Puppeteer 渲染）。多页用 <div class="page-break"> 分割，默认编辑单页。
  - 空内容：提示“请添加内容”，禁用导出。
  - 大文件：>10 页分批 POST（前端分页），超时 10s 重试。
  - 并发编辑：单用户场景，无需锁；多标签页刷新重置编辑。
- **约束**：
  - 图片上传：限 5MB/JPG/PNG，自动压缩。
  - 内容大小：单页 <1MB HTML，超过提示简化。
  - 错误处理：编辑崩溃回滚，导出失败 toast（“重试或检查格式”）。
  - 浏览器：Chrome/Edge/Firefox (>2025 版)，Safari iOS 15+（触屏优化）。

## 非功能需求
- **性能**：
  - 编辑延迟：<100ms（Tiptap 防抖）。
  - PDF 导出：<3s/页（Puppeteer），网络 <500ms。
  - 内存：前端 <200MB，后端 <100MB/页。
- **安全性**：
  - HTML 过滤：DOMPurify 防 XSS。
  - 上传验证：客户端检查图片格式/大小。
  - Puppeteer：沙箱模式（`--no-sandbox` 仅可信环境）。
- **兼容性**：
  - 前端：Chrome/Edge/Firefox，Safari iOS 15+。
  - 后端：Node.js 20+，Puppeteer v23.x，Chrome 120+。
- **可访问性**：
  - ARIA 标签（工具栏按钮），键盘导航（Tab 焦点）。

## 实施建议
### 技术栈
- **前端**：
  - Tiptap 开源（`@tiptap/react`, `starter-kit`, `extension-image`）。
  - Tailwind CSS（UI 样式），React DnD（图片拖拽）。
- **后端**：
  - Node.js 20+，Express（API），Puppeteer v24.x（PDF 渲染）。
  - Cors（跨域），queue（并发限制）。
- **依赖**：
  - npm: `@tiptap/react`, `@tiptap/starter-kit`, `@tiptap/extension-image`, `axios`, `dompurify`, `zustand`, `express`, `puppeteer-core`, `cors`.

